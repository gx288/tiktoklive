name: Check TikTok Live

on:
  schedule:
    - cron: '*/5 * * * *'  # chạy mỗi 5 phút
  workflow_dispatch:       # cho phép chạy thủ công

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install TikTokLive requests

      - name: Check if users are live
        env:
          TIKTOK_USERS: "charlidamelio youruser1 youruser2"  # thay bằng danh sách username cần theo dõi
        run: |
          python - <<EOF
          import asyncio
          import os
          from TikTokLive import TikTokLiveClient

          USERS = os.getenv("TIKTOK_USERS", "").split()

          async def check_user(username):
              try:
                  client = TikTokLiveClient(unique_id=username)
                  info = await client.is_live()
                  status = info.get("status", 0)
                  if status == 2:
                      print(f"LIVE DETECTED: @{username}")
                  else:
                      print(f"NOT live: @{username} (status: {status})")
              except Exception as e:
                  print(f"Error checking @{username}: {e}")

          async def main():
              tasks = [check_user(user) for user in USERS]
              await asyncio.gather(*tasks)

          asyncio.run(main())
          EOF
