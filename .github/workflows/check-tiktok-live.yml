name: Check TikTok Live

on:
  schedule:
    - cron: '*/5 * * * *'  # Mỗi 5 phút
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install TikTokLive requests

      - name: Check if users are live
        env:
          TIKTOK_USERS: "jack.vn41 charlidamelio youruser2"  # Thay username thật, cách nhau space
        run: |
          python - <<EOF
          import asyncio
          import os
          from TikTokLive import TikTokLiveClient

          USERS = os.getenv("TIKTOK_USERS", "").split()

          async def check_user(username):
              try:
                  client = TikTokLiveClient(unique_id=username)
                  is_live_now = await client.is_live()
                  if is_live_now:
                      print(f"LIVE DETECTED: @{username}")
                  else:
                      print(f"NOT live: @{username}")
              except Exception as e:
                  print(f"Error checking @{username}: {str(e)}")

          async def main():
              tasks = [check_user(user) for user in USERS]
              await asyncio.gather(*tasks)

          asyncio.run(main())
          EOF
